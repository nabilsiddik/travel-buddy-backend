generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// User enums
enum UserRole {
  SUPER_ADMIN
  ADMIN
  USER
}

enum UserStatus {
  ACTIVE
  BLOCKED
  DELETED
}

enum Gender {
  MALE
  FEMALE
  OTHERS
}

// Travel type enums
enum TravelType {
  SOLO
  FAMILY
  FRIENDS
}

// Payment enums
enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
}

// user models
model User {
  id       String   @id @default(uuid())
  name     String
  email    String   @unique
  password String
  role     UserRole @default(USER)

  bio             String?
  profileImage    String?
  currentLocation String?
  gender          Gender

  interests        String[]
  visitedCountries String[]

  subscription       Subscription?
  verifiedBadge      Boolean       @default(false)
  status             UserStatus    @default(ACTIVE)
  createdTravelPlans String[]

  travelPlans     TravelPlan[]
  reviewsGiven    Review[]     @relation("reviews_given")
  reviewsReceived Review[]     @relation("reviews_received")
  payments        Payment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

// travel plan models
model TravelPlan {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id])

  destination String
  startDate   DateTime
  endDate     DateTime

  budgetRange String?
  travelType  TravelType
  description String?
  visibility  Boolean    @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// review model
model Review {
  id String @id @default(uuid())

  reviewerId String
  receiverId String

  reviewer User @relation("reviews_given", fields: [reviewerId], references: [id])
  receiver User @relation("reviews_received", fields: [receiverId], references: [id])

  rating  Int
  comment String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Payment {
  id String @id @default(uuid())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  subscriptionId Int?
  subscription   Subscription? @relation(fields: [subscriptionId], references: [id])

  amount   Float
  currency String @default("usd")

  stripeInvoiceId     String  @unique
  stripePaymentIntent String?

  status PaymentStatus @default(PENDING)

  createdAt DateTime @default(now())
}

model Subscription {
  id                   Int                @id @default(autoincrement())
  userId               String             @unique
  user                 User               @relation(fields: [userId], references: [id])
  stripeCustomerId     String @unique
  stripeSubscriptionId String @unique
  status               SubscriptionStatus
  plan                 PlanType
  currentPeriodEnd     DateTime
  payments             Payment[]
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
}

enum SubscriptionStatus {
  active
  past_due
  canceled
  incomplete
}

enum PlanType {
  monthly
  yearly
}
